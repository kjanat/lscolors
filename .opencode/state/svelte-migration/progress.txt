# Progress Log
PRD: svelte-migration
Started: 2026-02-10

## Codebase Patterns
- **PM**: bun (not npm). Use `bun run build`, `bun test`, `bun install`
- **Strict TS**: noUncheckedIndexedAccess, exactOptionalPropertyTypes, no any, no `as`, no `!`
- **Vite base**: `/lscolors/` for GitHub Pages
- **VCS**: jj (colocated with git), default branch `master`
- **Formatter**: dprint (run `bun run format`)
- **Linter**: Biome (run `bun run lint`), formatter disabled in Biome
- **Testing**: Vitest, co-located *.test.ts, BDD style (describe/it), explicit imports
- **Pure logic layer**: bsd.ts, gnu.ts, sgr.ts, convert.ts, types.ts — NEVER modify
- **Svelte**: Svelte 5 runes ($state, $derived, $effect), no SvelteKit
- **Svelte MCP tools**: Use `svelte-file-editor` agent for .svelte files. Available tools:
  `list-sections` → discover docs, `get-documentation` → fetch docs, `svelte-autofixer` → validate code (MUST use before committing .svelte files). Call list-sections first, then get-documentation for relevant sections.
- **Overseer**: After completing each PRD task, also complete the matching Overseer task.
  Milestone: `task_01KH2KFK9HCYEMCKGB3JW2ESGE`
  Use `tasks.search("<task title>")` to find the Overseer task, then:
  `await tasks.complete("<overseer-task-id>", { result: "<what was done>" })`
  PRD task ID → Overseer task mapping:
  - toolchain-setup    → task_01KH2KHFNJBZM7S5J5P2427VQV
  - app-root           → task_01KH2KHFPN3AM2VGW20W92N0DW
  - copy-button        → task_01KH2KHFTBV2CJENNA6N2DTJ5W
  - lscolors-input     → task_01KH2KHFQK87YSQYS96X8TFXDG
  - ls-colors-input    → task_01KH2KHFRG2489XPKFSYATGT81
  - swap-control       → task_01KH2KHFSE3H59VZTHRTD4ASQF
  - share-button       → task_01KH2KHFV9R8STA5F15B3K5H87
  - preview-table      → task_01KH2KHFW6N3CZE6B757BPZ68A
  - hash-permalink     → task_01KH2KHFX40SGZHZM8SS92ZN3E
  - styles-migration   → task_01KH2KHFXXB28YH43K4HF5K8PX
  - delete-old-ui      → task_01KH2KHFYTCVTY6SEG9NFQ13BV
  - format-all         → task_01KH2M3KDTZ5D1E7309XENJ0Q0
  - component-tests    → task_01KH2M3KEQDC0FXN48Y425A167
  - e2e-tests          → task_01KH2M3KFMFJ5WJXKYK7QMF39A
  - update-agents-md   → task_01KH2M3KGHC3C200J6Y0NRHD10
  - verify-all         → task_01KH2KHFZJ2TD769NCNNPGTGE9

- **Svelte shims**: `src/svelte-shims.d.ts` declares `*.svelte` module type for TS. Uses `Component` from svelte (Svelte 5 style). The `/// <reference types="svelte" />` approach doesn't work with svelte-check — explicit `declare module` is needed.
- **Biome + Svelte**: `.svelte` files ignored in biome.json (Biome parses them via HTML support but gives false positives on Svelte patterns like reactive `let`). Biome formatter also disabled (dprint handles it via markup_fmt).
- **dprint + Svelte**: markup_fmt plugin already formats `.svelte` files out of the box. No extra config needed.
- **svelte-check**: runs via `bun run check`. Uses `--tsconfig ./tsconfig.json`.
- **Mount pattern**: `mount(App, { target })` where target is `<div id="app">`. Component renders `<main>` (no id) inside it. CSS `#app` styles apply to the wrapper div.
- **Pre-existing issues**: Biome formatter disagrees with dprint on trailing commas in jsonc and CSS transition shorthand formatting. Test project filtering (`--project server`) doesn't work with vitest 4 inline project config.

---
<!-- Task logs below - APPEND ONLY -->

## Task - toolchain-setup
- Added `svelte.config.js` with vitePreprocess()
- Added `"check"` script to package.json (`svelte-check --tsconfig ./tsconfig.json`)
- Created `src/svelte-shims.d.ts` with `declare module '*.svelte'` for TS
- Added `!!**/*.svelte` to biome.json file ignores
- Created minimal `src/App.svelte` placeholder (`<h1>LSCOLORS</h1>`)
- Files changed: biome.json, package.json, tsconfig.json (no change needed), src/App.svelte, src/svelte-shims.d.ts, svelte.config.js
- **Learnings:** svelte-check needs explicit `declare module '*.svelte'` in a .d.ts included by tsconfig; `/// <reference types="svelte" />` alone doesn't work. markup_fmt handles .svelte formatting. Most toolchain was already wired in prep commit.

## Task - app-root
- Rewrote `src/App.svelte` from placeholder to full monolithic component with all state, handlers, derived values, preview table, and clipboard logic
- Rewrote `src/main.ts` to `mount(App, { target })` with `instanceof HTMLElement` null check
- Stripped `index.html` to `<div id="app">` + script tag (Svelte renders `<main>` inside)
- State: 5 `$state` runes (direction, lscolorsValue, lsColorsValue, lscolorsError, lsColorsError)
- Derived: directionLabel, swapIcon, previewCssMap, previewBsdMap via `$derived`/`$derived.by`
- URL hash init runs synchronously before `$effect` to avoid stale-mount
- `$effect` syncs state → URL hash via `history.replaceState`
- Preview table uses `{#each BSD_SLOTS as slot (slot)}` with `{@const}` bindings + `style:` directives
- Clipboard: inline `copyToClipboard(event, text)` with `instanceof HTMLButtonElement` guard
- Files changed: src/App.svelte, src/main.ts, index.html
- **Learnings:** Svelte `mount()` renders component DOM *inside* the target element, so `<main id="app">` in the component would create duplicate IDs with `<div id="app">` mount target. Removed the id from `<main>`. CSS `#app` styles apply to the wrapper div. `bind:value` + `oninput` handler works without re-entrant guard — Svelte handles it. `maxlength` and `rows` should be expressions (`maxlength={22}`, `rows={4}`) not string attributes.
